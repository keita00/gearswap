[FULL THF.lua content goes here]